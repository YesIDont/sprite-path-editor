<!DOCTYPE html>
<html>
  <!-- illustrator reference
    https://i.stack.imgur.com/NQbhF.png
  -->
  
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Sprite Editor</title>
    
    <!-- libraries -->
    <script src='lib/imagetracer_v1.2.5.js'></script>
    <script src='lib/simplebar.js'></script>

    <link type='text/css' rel='stylesheet' href='css/reset.css'>
    <link type='text/css' rel='stylesheet' href='css/index.css'>
    <link type='text/css' rel='stylesheet' href='css/simplebar.css'>
  </head>
  
  <body>
    <div class='panel tools'>
      <button
        class='ico tool select'
        tooltip='Select and drag points.'>
          <img src='img/icons/select.svg' alt='Pan Camera' /></button>

      <button
        class='ico tool select-remove'
        tooltip='Remove point.'>
          <img src='img/icons/select-remove.svg' alt='Remove point' /></button>

      <button
        class='ico tool pan-viewport'
        tooltip='Pan Camera (Viewport). Hold space bar alternatively.'>
          <img src='img/icons/pan-viewport.svg' alt='Pan Camera' /></button>

      <button
        class='ico tool zoom-in'
        tooltip='Zoom in Camera. Use mouse scroll alternatively.'>
          <img src='img/icons/zoom-in.svg' alt='Zoom In' /></button>

      <button
        class='ico tool zoom-out'
        tooltip='Zoom out Camera. Use mouse scroll alternatively.'>
          <img src='img/icons/zoom-out.svg' alt='Zoom Out' /></button>
    </div>
    <div class='panel paths'>
      <div class='header'>
        <h5>Paths & Points</h5>
      </div>
      <p class='list-actions children-v-middle'>
          <input type='checkbox' id='select-all' class='switch selection'/>
            <span></span>
  
          <button class='ico-small' id='remove-selected' >
            <img src='img/icons/bin.svg' alt='Remove selected' /></button>
  
          <input type='checkbox' id='hide-all' class='switch visibility'/>
            <span></span>
        </p>

      <div class='content scrollbar'>
        <ul class='paths-container'></ul>
      </div>
    </div>

    <span class='workspace-settings-switch-background'></span>
    <div class='panel panel-expandable workspace-settings'>
      <input class='button' type='checkbox'/>
      <button><img src='img/icons/settings.svg' alt='Settings' /></button>

      <div class='content'>
        <h4>Workspace Settings</h4>
        <span class='background'>
          <h5>Background color:</h5>

          <span class='bg-chessboard'></span>
          <span class='bg-white'></span>
          <span class='bg-dark'></span>
          <span class='bg-pink-red'></span>
          <span class='bg-green'></span>
        </span>
      </div>
    </div>

    <canvas id='canvas'></canvas>
    
    <script src='js/utils.js'></script>
    <script src='js/settings.js'></script>
    <script src='js/requestAnimationFrame.js'></script>
    <script src='js/canvas.js'></script>
    <script src='js/draw.js'></script>
    <script src='js/point.js'></script>
    <script src='js/AABB.js'></script>
    <script src='js/path.js'></script>
    <script src='js/loaded-image.js'></script>
    <script src='js/keyboard.js'></script>
    <script src='js/mouse.js'></script>
    <script src='js/tools.js'></script>
    <script src='js/components/ListItem.js'></script>

    <script>
      let scrolls = [];
      get('.scrollbar').forEach( el => {
        scrolls[ el ] = new SimpleBar( el, { forceVisible: true, autoHide: false } )
      })

      pathsList.addPath = function( item ) {

        let li = ListItem( item );

        // add points listing
        let points = ul({ class: 'points' });
        item.points.forEach( p => {
          points.appendChild( ListItem( p ))
        })
        li.appendChild( points );
        
        this.appendChild( li )
      }

      get('.workspace-settings .background span').forEach(
        element => element.on('click', () => body.className = element.className ));
      
      // select / unselect all paths
      get('.paths .list-actions #select-all')[0].on('click', e => {
        let listItems = Array.from( pathsList.children );

        if( e.target.checked ) {
          loadedImage.paths.forEach( p => {
            p.select();
            mouse.selection.add( p )
          })
          listItems.forEach( i => {
            i.getElementsByClassName('selection')[0].checked = true
          })
        }
        else {
          loadedImage.paths.forEach( p => p.unSelect())
          listItems.forEach( i => {
            i.getElementsByClassName('selection')[0].checked = false
          })
          mouse.selection.clear()
        }
      });
      
      // show / hide all
      get('.panel.paths p.list-actions #hide-all')[0].on('click', e => {
        let listItems = Array.from( pathsList.children );

        if( e.target.checked ) {
          loadedImage.paths.forEach( p => p.hide() )
          listItems.forEach( i => {
            i.getElementsByClassName('visibility')[0].checked = true
          })
        }
        else {
          loadedImage.paths.forEach( p => p.show() )
          listItems.forEach( i => {
            i.getElementsByClassName('visibility')[0].checked = false
          })
        }
      });

      // remove all selected
      get.id('remove-selected').on('click', () => {
        mouse.selection.removeSelected()
      })
      
      let loadedImage;

      // @loop
      function updateWorkspace() {
        c.setTransform( 1, 0, 0, 1, 0, 0 );
        c.clearRect( 0, 0, canvas.width, canvas.height );
        c.translate( canvas.offset.x, canvas.offset.y )
        
        // coursors
        if( 32 in keysDown || canvas.allow.actions.panDragging ) canvas.className = 'cursor-move'
        else if ( canvas.allow.actions.zoomIn ) canvas.className = 'cursor-zoom-in'
        else if ( canvas.allow.actions.zoomOut ) canvas.className = 'cursor-zoom-out'
        else canvas.className = '';

        // draw loaded image
        loadedImage.draw();
        // draw all computed paths and their points
        loadedImage.drawPaths();

        const { x, y } = mouse.getCanvasPos();
        if( mouse.isDown.left && canvas.allow.actions.selection && !( 32 in keysDown )) mouse.selection.draw();

        requestAnimationFrame( updateWorkspace );
      }
      
      window.on('load', () => {
        loadedImage = new LoadedImage( 'dummy.png' );

        // set initial canvas (vievport) offset used to pan picture
        canvas.offset.set(
          ( canvas.width / 2 ) - ( loadedImage.image.width / 2 * SETTINGS.scale ),
          ( canvas.height / 2 ) - ( loadedImage.image.height / 2 * SETTINGS.scale )
        )

        // add computed paths to 'Paths' panel
        wait(
          () => loadedImage.arePathsLoaded(),
          () => loadedImage.paths.forEach( p => pathsList.addPath( p ))
        )

        updateWorkspace();
      });
    </script>

  </body>
</html> 